# This workflow will run tests using node and then publish a package to GitHub Packages when a release is created
# For more information see: https://help.github.com/actions/language-and-framework-guides/publishing-nodejs-packages

name: Node.js Package

on:
  push:
    branches: [master]
  pull_request:
    branches: [master]
  release:
    types: [created]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v2
        with:
          node-version: 12
      - run: npm ci
      - run: npm test
      - run: echo "$HELLO_WORLD+ $HWORLD"
      - run: echo "${{ secrets.HELLO_WORLD }}"
      - run: echo "${{ secrets.HWORLD }}"
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@master
      - name: kubectl - Google Cloud GKE cluster.
        uses: ameydev/gke-kubectl-action@master
        env:
          PROJECT_ID: heroic-mechanic-316419
          APPLICATION_CREDENTIALS: ewogICJ0eXBlIjogInNlcnZpY2VfYWNjb3VudCIsCiAgInByb2plY3RfaWQiOiAiaGVyb2ljLW1l Y2hhbmljLTMxNjQxOSIsCiAgInByaXZhdGVfa2V5X2lkIjogIjc3NTAyYjZhMzc4NWM5YjFkZjJk N2ZhNGYzZmY3NTlhZTg2NDM4ZjkiLAogICJwcml2YXRlX2tleSI6ICItLS0tLUJFR0lOIFBSSVZB VEUgS0VZLS0tLS1cbk1JSUV2Z0lCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktnd2dnU2tBZ0VB QW9JQkFRQ3F5ejZjTVBBYk4xMFlcbkdjbzlXNEZKRyt3K2tzOWZkeGNmU3kreEFZeTJUbmlvWWti YlhYUG5sak43bmlabjMwNGFLaFpoOGk3eEtBT0dcbjByRlZsVThWdTJESWVuUkJ6SVdyenVaNVlw bENJU3U0Q0E0WWExd25mM3ZvTDJLcmR2a0lock1GNVg1SzBMWFdcbmlobTdGSmhVNnBvVjMwQVN4 TzMwc0MzUnNsRHNKRllpMWJEbTdLd1VqSThvMnh6c1h4d3RTcTZPYUJ2RWlCWTRcbnFSQmJHU1dt MG02WFFNK3NoLzRiVjc4RUllNlEyK0xtZC83cUk3dU1yU1Q3Qm9lRngvdE91WHM4cXlHR0d6WUFc bkdHM0dUc0V4VHpoS2pxKzA0TjlndTFmdEZyNUVyVUdGU0R0UGZZSFR3eHdyclJOc2x4dWdvcS9r Q1FHU1FFWG1cbmdiRzhYRXg1QWdNQkFBRUNnZ0VBVkFFSFdIZFJnWEZubm5VQTNkRGw4L21CNXZ6 NmRpL3k5WGRiaTZvQmRhRi9cbkF3TGphdjI2Qmt3QUltc1U1TDRXZ2hQMVVsTjE5ek1CR1EwRUg5 NENPZVFocERsbWVQNkpPSW5aSGhiNjNtWEdcblJRdmhNdTJMTS9vbURYdFJBcGpQdi92UWpiUGt2 Qk9QZkdnTVk5R3JZd2pJcEwxYm5GK3owa2ZkSVdpZEdLZXdcbklEbnJzSDN1MGFQaUlyY2l0bGxs a0Q3RE9kUkZ0cUIzVUpMNVFFd2xSMDgrN3FwaG5ENjlrV3Z5MXZGd0JYSDlcbmhPczJ0RGFGVVJn UGRPMHUrWlo5OXBkTGtid3ZUZ3h2WkJ5dlJXUWVzZ1ptUEZWaWg3ejczR1pXWkh5UU5uVFhcbkZa RTRHZU1ZdWIyVTZXbWpYcy9ZMExWeC9pL01BVE9jVTJia2VvQ0FDUUtCZ1FEa1dZK1VrR0djSTRG QXZzNlBcbk1YSkhIdFlXWVo2clAyNmZ5Y084aG5Cd1ZKY0hWMTJhVU1IcDFDM1I4WE9nTDRPYmpl VTNIc2FZVXNnMTFiWlJcblJpenJyRmtmNUhpZmhtUmdVSHB2QjNLZmhPV1hkc2tDK2NmbWRhWTB4 dlJKKzRtUkFPUmg2aGdEdWlCSFI3K25cbm1BOTM0OVpyd0kwUUkwb1ZmbFBNTHhhdWR3S0JnUUMv ZVkxdUNwTGg4Z0hydFE3dzFXY1RObnJybjc0RnpobW5cbldPRGxzcWdQZDJWbDlyTkF2Z00zdHF3 WGxrS3ZlS0ZtZUpyeW55NWRCOUZEL1V2ODBuem10WG1EKzYwQy9XR2ZcblQ2MlpFb3Awd3NDalRK Nlg5alNJdEN1bmdLWW9Wa0JJdXBWVWZMUlZ5OUdTbFZCYkFYQ1FOanBWN25NY00ySm9cbjFZL0tN RlBvandLQmdEVlpFeWxEUGZxcmROUDZmK21HUk11RzBiOXkyUTNyQ040OTFnUGlhTHhsbHM4NVF2 MzlcblpnQkorTloya1d2WURlZzJrMWw0VUM5Z0Q3UThGSmNTVFFaV1FwQW40V0pybEdISUM0S0sr K1YydCtqVjhJcElcbmJzSlJ0QjNhYVZJcmVPMHVoeXkwOHgxVHk1eTdqM1FKRzN3SDk1MCs0L1hr T0xlaXh0TUtJVU5yQW9HQkFKUk1cbmljekw1YjJZR2dLOFpna0R6K1Npa292Q1dvUFdnQ29ML1l3 S1ZuNDhKRTNYeURnQnN5NUlqbnRxUnRYdklWcmpcbldHZElBTG5QSHphQWpZVVFaZXF1YmFKYW9F S3JpeHUvczUzV0xXU0hubm9jRXMxeHhIaUl5ekxkd2xPRmtoNkNcblhMeG1KYW81eFdTNXZ0WHRo SWc5WitzOFZ1MWxvdmU5U0xQNXdGTmpBb0dCQU9Ba2FzRUsyQjFJTzF4S3dFZi9cbnREUXM4Uklh enFRWmR5R3lWUEVWQ1BlUlVBbjAxVDlyb01pczU1bGF2RVdiRk1RR0Y1cmE2UFUyMFVrOENxaFFc blZYTGFhUjhUY2VkMHdrUENsUFJXSFJyV0QxTUhRN3N0UnVCUHNTamdNbklTNjA3MjBMQ3ZOcEtU bTlOZVpVdUFcbitBdUllbFBiRlZtbVdPdGQxQU9FdnZJYVxuLS0tLS1FTkQgUFJJVkFURSBLRVkt LS0tLVxuIiwKICAiY2xpZW50X2VtYWlsIjogIjEwNDU4MDMyMzYwNDgtY29tcHV0ZUBkZXZlbG9w ZXIuZ3NlcnZpY2VhY2NvdW50LmNvbSIsCiAgImNsaWVudF9pZCI6ICIxMTIzODg0MzE2NTI2Nzkz Mzg0NTMiLAogICJhdXRoX3VyaSI6ICJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20vby9vYXV0 aDIvYXV0aCIsCiAgInRva2VuX3VyaSI6ICJodHRwczovL29hdXRoMi5nb29nbGVhcGlzLmNvbS90 b2tlbiIsCiAgImF1dGhfcHJvdmlkZXJfeDUwOV9jZXJ0X3VybCI6ICJodHRwczovL3d3dy5nb29n bGVhcGlzLmNvbS9vYXV0aDIvdjEvY2VydHMiLAogICJjbGllbnRfeDUwOV9jZXJ0X3VybCI6ICJo dHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9yb2JvdC92MS9tZXRhZGF0YS94NTA5LzEwNDU4MDMy MzYwNDgtY29tcHV0ZSU0MGRldmVsb3Blci5nc2VydmljZWFjY291bnQuY29tIgp9Cg==
          CLUSTER_NAME: hellogithub
          ZONE_NAME: us-central1-c
        with:
          args: apply -f deployment.yml -n staging
